# Tumor-based benchmark

## Introduction

This benchmark is based on the cptac dataset which contains genomics,
proteomics and phosphoproteomics information of multiple patients from
different cancer types. Here, the proteomics data was used to identify a
gold standard set of deregulated kinases per patient which are expected
to have an increased or decreased activity.

The phosphoproteomic data is then used to infer kinase activities and to
evaluate which method and kinase-substrate library is able to
recapitulate the gold standard set of kinases.

For this, we provide the normalized abundance of phosphorylation sites
for each patient across different cancer types.

## Getting set up

We first load the required packages to run the benchmark.

``` r
library(benchmarKIN)
library(dplyr)
#> 
#> Attaching package: 'dplyr'
#> The following objects are masked from 'package:stats':
#> 
#>     filter, lag
#> The following objects are masked from 'package:base':
#> 
#>     intersect, setdiff, setequal, union
```

## CPTAC data

We then take a look at the phosphoproteomics data from CPTAC. This data
is stored as a long data frame in cptacData. For our analysis we will
transform it to a list of wide data frames for each cancer type which
can be used for activity inference.

``` r
cptac_list <- purrr::map(unique(cptacData$cancer), function(cancer_type){
  cptacData %>%
    dplyr::filter(cancer == cancer_type) %>%
    tidyr::pivot_wider(names_from = "sample", values_from = "statistic", values_fill = NA) %>%
    dplyr::select(-cancer) %>%
    tibble::column_to_rownames("id")
})

names(cptac_list) <- unique(cptacData$cancer)
```

## Activity estimation

Here, we will test the z-score (as implemented by RoKAI) in combination
with the PhosphoSitePlus kinase-substrate library as in example.

In theory any other method can also be tested with that data.

### Kinase-substrate library

For that we have already processed a version of PhosphoSitePlus
(accessed: 19/04/2023) that can be mapped to our phosphorylation site
ids.

``` r
head(phosphositeplus)
#> # A tibble: 6 × 8
#>   source  target      target_protein position   mor sequence ENSEMBL ENSEMBLPROT
#>   <chr>   <chr>       <chr>          <chr>    <dbl> <chr>    <chr>   <chr>      
#> 1 EIF2AK1 EIF2S1_S52  EIF2S1         S52          1 MILLSEL… ENSG00… <NA>       
#> 2 EIF2AK1 EIF2S1_S49  EIF2S1         S49          1 IEGMILL… ENSG00… <NA>       
#> 3 PRKCD   HDAC5_S259  HDAC5          S259         1 FPLRKTA… ENSG00… <NA>       
#> 4 PRKCD   PTPRA_S204  PTPRA          S204         1 PLLARSP… ENSG00… <NA>       
#> 5 PRKCD   BCL2_S70    BCL2           S70          1 RDPVART… ENSG00… <NA>       
#> 6 PRKCD   HNRNPK_S302 HNRNPK         S302         1 GRGGRGG… ENSG00… <NA>
```

After mapping the phosphorylation sites we can bring it into the right
format to run the run_zscore function.

``` r
pps_id <- cptacData$id %>% 
  unique()
map_pps <- data.frame(pps_id = pps_id) %>%
  dplyr::mutate(ENSEMBL = purrr::map_chr(stringr::str_split(pps_id, "\\|"), 1)) %>%
  dplyr::mutate(ENSEMBL = purrr::map_chr(stringr::str_split(ENSEMBL, "\\."), 1))  %>%
  dplyr::mutate(sequence = purrr::map_chr(stringr::str_split(pps_id, "\\|"), 4))
mapped_phosphositeplus <- phosphositeplus %>%
  dplyr::left_join(map_pps, by = c("ENSEMBL", "sequence"), relationship = "many-to-many") %>%
  dplyr::mutate(target = pps_id) %>%
  dplyr::filter(!is.na(pps_id)) %>%
  dplyr::select(source, target, mor) %>%
  dplyr::distinct()
```

### Activity inference using the z-score

The z-score calculates a score for each kinase by aggregating the change
in abundance of the direct targets in relation to changes in the
non-targets.

``` r
act_scores <- purrr::map(cptac_list, ~list(zscore_ppsp = run_zscore(mat = .x, network = mapped_phosphositeplus)))
```

## CPTAC benchmark

### Gold standard set of kinases

The gold standard set contains kinases per patient which are expected to
have a high or a low activity. Here we can look at the kinases which are
supposed to have a high activity for patients which BRCA.

``` r
str(cptacGS$BRCA$GS_pos_pairs)
#> List of 363
#>  $ SCYL3   : chr [1:8] "X11BR009" "X11BR022" "X11BR011" "X05BR016" ...
#>  $ FGR     : chr [1:6] "X01BR018" "X05BR042" "X11BR006" "X11BR004" ...
#>  $ AK2     : chr [1:7] "X11BR025" "X01BR001" "X20BR002" "X03BR010" ...
#>  $ CAMKK1  : chr [1:5] "X11BR028" "X11BR054" "X14BR005" "X11BR075" ...
#>  $ PDK4    : chr [1:2] "X03BR005" "X05BR026"
#>  $ PDK2    : chr [1:6] "X11BR025" "X11BR028" "X11BR019" "X03BR005" ...
#>  $ AGK     : chr [1:11] "X01BR001" "X11BR073" "X20BR002" "X03BR010" ...
#>  $ MARK4   : chr [1:5] "X11BR047" "X11BR023" "X11BR054" "X11BR036" ...
#>  $ CDKL5   : chr [1:6] "X11BR047" "X11BR031" "X11BR053" "X11BR028" ...
#>  $ CDK11A  : chr "X01BR043"
#>  $ NADK    : chr [1:8] "X11BR019" "X05BR001" "X11BR006" "X11BR004" ...
#>  $ BAZ1B   : chr [1:9] "X11BR023" "X01BR031" "X01BR018" "X05BR042" ...
#>  $ BTK     : chr [1:6] "X11BR019" "X11BR030" "X05BR001" "X01BR030" ...
#>  $ FYN     : chr [1:4] "X11BR030" "X01BR030" "X01BR043" "X01BR008"
#>  $ MAP4K5  : chr [1:4] "X01BR033" "X05BR001" "X22BR005" "X05BR005"
#>  $ CLK1    : chr [1:3] "X20BR001" "X11BR006" "X11BR018"
#>  $ PRKCH   : chr [1:8] "X11BR003" "X11BR030" "X11BR011" "X18BR003" ...
#>  $ VRK2    : chr [1:5] "X11BR049" "X01BR032" "X11BR032" "X11BR027" ...
#>  $ MAP2K3  : chr [1:6] "X11BR023" "X09BR005" "X11BR030" "X05BR001" ...
#>  $ DAPK2   : chr [1:6] "X11BR023" "X20BR007" "X01BR031" "X11BR004" ...
#>  $ PI4K2B  : chr [1:5] "X11BR011" "X05BR042" "X05BR044" "X01BR025" ...
#>  $ PNKP    : chr [1:5] "X11BR019" "X14BR005" "X05BR029" "X05BR004" ...
#>  $ MAPK9   : chr [1:6] "X11BR074" "X11BR025" "X01BR032" "X11BR032" ...
#>  $ PIK3CB  : chr [1:6] "X01BR027" "X11BR009" "X03BR010" "X05BR044" ...
#>  $ EIF2AK2 : chr [1:7] "X11BR023" "X11BR024" "X14BR005" "X01BR040" ...
#>  $ CDK14   : chr [1:5] "X05BR045" "X11BR053" "X01BR018" "X05BR009" ...
#>  $ CAMK2B  : chr [1:5] "X18BR004" "X20BR001" "X11BR038" "X11BR036" ...
#>  $ ALDH18A1: chr [1:6] "X01BR001" "X11BR073" "X03BR010" "X22BR005" ...
#>  $ SPHK2   : chr [1:3] "X11BR004" "X11BR059" "X01BR044"
#>  $ ADCK1   : chr [1:3] "X11BR006" "X01BR025" "X01BR044"
#>  $ DGKA    : chr [1:6] "X11BR047" "X06BR003" "X11BR030" "X18BR003" ...
#>  $ ERBB3   : chr [1:6] "X11BR031" "X11BR073" "X18BR006" "X21BR001" ...
#>  $ MYLK    : chr [1:9] "X06BR006" "X18BR002" "X03BR013" "X01BR033" ...
#>  $ MAP2K4  : chr [1:6] "X11BR025" "X01BR032" "X14BR005" "X11BR027" ...
#>  $ PRKCQ   : chr [1:2] "X06BR003" "X01BR042"
#>  $ TIE1    : chr [1:5] "X14BR008" "X03BR013" "X01BR023" "X03BR011" ...
#>  $ PFKP    : chr [1:7] "X01BR027" "X20BR005" "X20BR002" "X01BR043" ...
#>  $ PKM     : chr [1:6] "X11BR047" "X18BR002" "X11BR042" "X01BR043" ...
#>  $ PRKCZ   : chr [1:4] "X01BR032" "X11BR054" "X11BR075" "X06BR014"
#>  $ PDK3    : chr [1:9] "X11BR025" "X01BR001" "X05BR045" "X05BR016" ...
#>  $ COASY   : chr [1:8] "X06BR003" "X11BR025" "X03BR004" "X22BR005" ...
#>  $ IP6K2   : chr "X11BR016"
#>  $ MAST4   : chr [1:5] "X11BR053" "X18BR004" "X11BR019" "X11BR054" ...
#>  $ TESK2   : chr [1:8] "X03BR004" "X11BR009" "X20BR001" "X03BR002" ...
#>  $ MAP4K4  : chr [1:5] "X05BR045" "X18BR002" "X05BR029" "X03BR006" ...
#>  $ MYO3B   : chr [1:2] "X20BR001" "X11BR027"
#>  $ PRKACA  : chr [1:5] "X01BR032" "X03BR005" "X11BR036" "X22BR006" ...
#>  $ SPEG    : chr [1:4] "X20BR007" "X05BR009" "X05BR029" "X01BR009"
#>  $ STK10   : chr [1:6] "X11BR023" "X11BR003" "X11BR073" "X11BR019" ...
#>  $ ALPK1   : chr [1:4] "X11BR053" "X11BR050" "X03BR005" "X01BR044"
#>  $ NUAK1   : chr [1:4] "X11BR047" "X11BR055" "X05BR005" "X11BR080"
#>  $ DGKD    : chr [1:5] "X18BR004" "X20BR001" "X03BR010" "X11BR038" ...
#>  $ PAK3    : chr [1:4] "X01BR018" "X05BR042" "X11BR016" "X05BR029"
#>  $ FGFR1   : chr [1:9] "X11BR053" "X14BR008" "X18BR002" "X03BR013" ...
#>  $ STK17B  : chr [1:3] "X05BR045" "X11BR003" "X11BR030"
#>  $ AK6     : chr [1:6] "X01BR017" "X09BR005" "X11BR025" "X05BR045" ...
#>  $ MAST2   : chr [1:6] "X01BR001" "X14BR008" "X11BR016" "X01BR040" ...
#>  $ EIF2AK1 : chr [1:6] "X11BR025" "X11BR053" "X18BR004" "X20BR001" ...
#>  $ SEPHS1  : chr [1:8] "X18BR017" "X01BR027" "X20BR002" "X11BR010" ...
#>  $ ITPKC   : chr [1:7] "X18BR017" "X11BR017" "X09BR007" "X11BR019" ...
#>  $ NLK     : chr [1:3] "X01BR040" "X11BR075" "X21BR001"
#>  $ AURKA   : chr [1:7] "X11BR023" "X05BR042" "X11BR016" "X11BR036" ...
#>  $ MAPKAPK5: chr [1:6] "X01BR027" "X18BR004" "X11BR006" "X11BR055" ...
#>  $ IRAK3   : chr [1:7] "X09BR007" "X11BR020" "X11BR004" "X01BR040" ...
#>  $ MAP3K20 : chr [1:4] "X18BR004" "X11BR038" "X11BR059" "X09BR004"
#>  $ TRPM7   : chr [1:4] "X11BR047" "X05BR026" "X11BR072" "X18BR016"
#>  $ XYLB    : chr [1:7] "X11BR017" "X20BR002" "X20BR008" "X03BR010" ...
#>  $ MAP3K1  : chr [1:7] "X11BR025" "X21BR010" "X11BR009" "X18BR003" ...
#>  $ SRPK1   : chr [1:11] "X11BR023" "X01BR027" "X11BR003" "X20BR007" ...
#>  $ JAK2    : chr [1:5] "X11BR053" "X14BR008" "X21BR010" "X01BR018" ...
#>  $ ABL1    : chr [1:3] "X11BR056" "X11BR036" "X13BR009"
#>  $ CDC7    : chr [1:4] "X01BR018" "X05BR042" "X05BR043" "X11BR036"
#>  $ MAST3   : chr [1:6] "X11BR023" "X01BR017" "X11BR010" "X03BR005" ...
#>  $ MKNK2   : chr [1:8] "X11BR053" "X14BR008" "X05BR026" "X11BR038" ...
#>  $ GRK3    : chr [1:9] "X11BR073" "X11BR013" "X03BR005" "X11BR006" ...
#>  $ ITPK1   : chr [1:8] "X18BR017" "X09BR007" "X11BR013" "X01BR025" ...
#>  $ VRK1    : chr [1:11] "X11BR023" "X01BR027" "X20BR005" "X11BR015" ...
#>  $ RPS6KA5 : chr [1:7] "X06BR003" "X18BR017" "X05BR016" "X14BR005" ...
#>  $ STK4    : chr [1:10] "X11BR023" "X11BR003" "X11BR020" "X11BR030" ...
#>  $ PTK6    : chr [1:8] "X11BR028" "X20BR008" "X05BR044" "X11BR042" ...
#>  $ CSNK2A1 : chr [1:7] "X05BR042" "X14BR005" "X11BR044" "X11BR016" ...
#>  $ HCK     : chr [1:7] "X05BR045" "X11BR024" "X05BR042" "X01BR043" ...
#>  $ PRPS2   : chr [1:4] "X11BR031" "X11BR009" "X09BR007" "X11BR016"
#>  $ BMX     : chr [1:3] "X11BR050" "X01BR031" "X03BR005"
#>  $ PGK1    : chr [1:7] "X01BR017" "X11BR017" "X18BR002" "X11BR020" ...
#>  $ CDK16   : chr [1:7] "X01BR001" "X01BR027" "X20BR002" "X01BR025" ...
#>  $ FLT1    : chr [1:7] "X03BR013" "X18BR004" "X20BR008" "X01BR031" ...
#>  $ DGKH    : chr [1:7] "X01BR027" "X18BR004" "X01BR043" "X01BR044" ...
#>  $ MAPK3   : chr [1:7] "X06BR003" "X18BR017" "X14BR008" "X03BR004" ...
#>  $ NME3    : chr [1:8] "X11BR025" "X01BR032" "X11BR053" "X03BR004" ...
#>  $ NME4    : chr [1:8] "X09BR005" "X11BR053" "X11BR019" "X22BR005" ...
#>  $ EEF2K   : chr [1:10] "X11BR047" "X11BR017" "X11BR031" "X11BR053" ...
#>  $ BCKDK   : chr [1:6] "X11BR025" "X03BR004" "X03BR010" "X01BR025" ...
#>  $ RIPK2   : chr [1:12] "X11BR023" "X01BR001" "X20BR005" "X20BR002" ...
#>  $ IKBKB   : chr [1:6] "X11BR025" "X03BR004" "X14BR005" "X01BR025" ...
#>  $ STK3    : chr [1:8] "X01BR001" "X01BR027" "X11BR013" "X11BR016" ...
#>  $ MAP4K1  : chr [1:6] "X11BR003" "X11BR073" "X11BR030" "X18BR003" ...
#>  $ VRK3    : chr [1:9] "X11BR023" "X09BR005" "X11BR031" "X18BR004" ...
#>  $ DYRK1B  : chr [1:2] "X11BR054" "X11BR012"
#>   [list output truncated]
```

## Area under the receiver operator curve

The inferred kinase activities can then be evaluated using the
benchmarkROC() function. Hereby, it is important to note that the kinase
symbol needs to match with the gold standard set (here gene symbols).

``` r
performance <- benchmarkROC(score_lists = act_scores, GS_list = cptacGS)
```

We can then plot the areas under the receiver operator curve (AUROCs)
and can compare this with other methods or prior knowledge resources.

``` r
auroc_p <- performance %>%
  ggplot2::ggplot(ggplot2::aes(x=method, y=auroc)) +
  ggplot2::geom_boxplot(outlier.size=1, lwd=0.6) +
  ggplot2::geom_hline(yintercept = 0.5)
auroc_p
```

![](/private/var/folders/th/nbdnn8l96tx88tt8nm212dpw0000gn/T/Rtmp0r0KxJ/preview-341363cca2cc.dir/tumorBench_files/figure-markdown_github/plot-1.png)
